<!-- saved from url=(0014)about:internet -->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
<title>Camera3D.as</title>
<link rel="stylesheet" type="text/css" href="../../../../../../SourceStyles.css"/>
</head>

<body><pre><span class="ActionScriptpackage">package</span> <span class="ActionScriptDefault_Text">org</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">papervision3d</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">cameras</span>
<span class="ActionScriptBracket/Brace">{</span>
    <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">flash</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">geom</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">Rectangle</span>;
    <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">flash</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">utils</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">getTimer</span>;
    
    <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">org</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">papervision3d</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">core</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">culling</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">FrustumCuller</span>;
    <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">org</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">papervision3d</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">core</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">geom</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">renderables</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">Triangle3D</span>;
    <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">org</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">papervision3d</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">core</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">geom</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">renderables</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">Vertex3D</span>;
    <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">org</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">papervision3d</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">core</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">geom</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">renderables</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">Vertex3DInstance</span>;
    <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">org</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">papervision3d</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">core</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">math</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">Matrix3D</span>;
    <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">org</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">papervision3d</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">core</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">proto</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">CameraObject3D</span>;
    <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">org</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">papervision3d</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">core</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">render</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">data</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">RenderSessionData</span>;
    <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">org</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">papervision3d</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">objects</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">DisplayObject3D</span>;
    
    <span class="ActionScriptASDoc">/**
     * Camera3D is the basic camera used by Papervision3D.
     * &lt;/p&gt;
     * 
     * @author Tim Knip
     */</span> 
    <span class="ActionScriptReserved">public</span> <span class="ActionScriptclass">class</span> <span class="ActionScriptDefault_Text">Camera3D</span> <span class="ActionScriptReserved">extends</span> <span class="ActionScriptDefault_Text">CameraObject3D</span>
    <span class="ActionScriptBracket/Brace">{</span>    
        <span class="ActionScriptASDoc">/**
         * Constructor.
         * 
         * @param    fov        This value is the vertical Field Of View (FOV) in degrees.
         * @param    near    Distance to the near clipping plane.
         * @param    far        Distance to the far clipping plane.
         * @param    useCulling        Boolean indicating whether to use frustum culling. When true all objects outside the view will be culled.
         * @param    useProjection     Boolean indicating whether to use a projection matrix for perspective.
         */</span> 
        <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">Camera3D</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">fov</span>:<span class="ActionScriptDefault_Text">Number</span><span class="ActionScriptOperator">=</span>60<span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">near</span>:<span class="ActionScriptDefault_Text">Number</span><span class="ActionScriptOperator">=</span>10<span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">far</span>:<span class="ActionScriptDefault_Text">Number</span><span class="ActionScriptOperator">=</span>5000<span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">useCulling</span>:<span class="ActionScriptDefault_Text">Boolean</span><span class="ActionScriptOperator">=</span><span class="ActionScriptReserved">false</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">useProjection</span>:<span class="ActionScriptDefault_Text">Boolean</span><span class="ActionScriptOperator">=</span><span class="ActionScriptReserved">false</span><span class="ActionScriptBracket/Brace">)</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptReserved">super</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">near</span><span class="ActionScriptOperator">,</span> 40<span class="ActionScriptBracket/Brace">)</span>;
            
            <span class="ActionScriptReserved">this</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">fov</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">fov</span>; 
            
            <span class="ActionScriptDefault_Text">_prevFocus</span> <span class="ActionScriptOperator">=</span> 0;
            <span class="ActionScriptDefault_Text">_prevZoom</span> <span class="ActionScriptOperator">=</span> 0;
            <span class="ActionScriptDefault_Text">_prevOrtho</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">false</span>;
            <span class="ActionScriptDefault_Text">_prevUseProjection</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">false</span>;
            <span class="ActionScriptDefault_Text">_useCulling</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">useCulling</span>;
            <span class="ActionScriptDefault_Text">_useProjectionMatrix</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">useProjection</span>;
            <span class="ActionScriptDefault_Text">_far</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">far</span>;
            <span class="ActionScriptDefault_Text">_focusFix</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">Matrix3D</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">IDENTITY</span>;
        <span class="ActionScriptBracket/Brace">}</span>
        
        <span class="ActionScriptASDoc">/**
         * Orbits the camera around the specified target. If no target is specified the 
         * camera's #target property is used. If this camera's #target property equals null
         * the camera orbits the origin (0, 0, 0).
         * 
         * @param    pitch    Rotation around X=axis (looking up or down).
         * @param    yaw        Rotation around Y-axis (looking left or right).
         * @param    useDegrees     Whether to use degrees for pitch and yaw (defaults to 'true').
         * @param    target    An optional target to orbit around.
         */</span> 
        <span class="ActionScriptReserved">public</span> <span class="ActionScriptReserved">override</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">orbit</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">pitch</span>:<span class="ActionScriptDefault_Text">Number</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">yaw</span>:<span class="ActionScriptDefault_Text">Number</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">useDegrees</span>:<span class="ActionScriptDefault_Text">Boolean</span><span class="ActionScriptOperator">=</span><span class="ActionScriptReserved">true</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">target</span>:<span class="ActionScriptDefault_Text">DisplayObject3D</span><span class="ActionScriptOperator">=</span><span class="ActionScriptReserved">null</span><span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptReserved">void</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptDefault_Text">target</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">target</span> <span class="ActionScriptOperator">||</span> <span class="ActionScriptDefault_Text">_target</span>;
            <span class="ActionScriptDefault_Text">target</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">target</span> <span class="ActionScriptOperator">||</span> <span class="ActionScriptDefault_Text">DisplayObject3D</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">ZERO</span>;

            <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">useDegrees</span><span class="ActionScriptBracket/Brace">)</span>
            <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptDefault_Text">pitch</span> <span class="ActionScriptOperator">*=</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">Math</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">PI</span><span class="ActionScriptOperator">/</span>180<span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptDefault_Text">yaw</span> <span class="ActionScriptOperator">*=</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">Math</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">PI</span><span class="ActionScriptOperator">/</span>180<span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptBracket/Brace">}</span>
            
            <span class="ActionScriptComment">// Number3D.sub
</span>            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">dx</span>             :<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">target</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">world</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">n14</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptReserved">this</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">dy</span>             :<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">target</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">world</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">n24</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptReserved">this</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">dz</span>             :<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">target</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">world</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">n34</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptReserved">this</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">z</span>;
            
            <span class="ActionScriptComment">// Number3D.modulo
</span>            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">distance</span>     :<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">Math</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">sqrt</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">dx</span><span class="ActionScriptOperator">*</span><span class="ActionScriptDefault_Text">dx</span><span class="ActionScriptOperator">+</span><span class="ActionScriptDefault_Text">dy</span><span class="ActionScriptOperator">*</span><span class="ActionScriptDefault_Text">dy</span><span class="ActionScriptOperator">+</span><span class="ActionScriptDefault_Text">dz</span><span class="ActionScriptOperator">*</span><span class="ActionScriptDefault_Text">dz</span><span class="ActionScriptBracket/Brace">)</span>;

            <span class="ActionScriptComment">// Rotations
</span>            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">rx</span> :<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">Math</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">cos</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">yaw</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">Math</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">sin</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">pitch</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">rz</span> :<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">Math</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">sin</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">yaw</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">Math</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">sin</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">pitch</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">ry</span> :<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">Math</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">cos</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">pitch</span><span class="ActionScriptBracket/Brace">)</span>;
            
            <span class="ActionScriptComment">// Move to specified location
</span>            <span class="ActionScriptReserved">this</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">target</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">world</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">n14</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">rx</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">distance</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptReserved">this</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">target</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">world</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">n24</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">ry</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">distance</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptReserved">this</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">z</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">target</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">world</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">n34</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">rz</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">distance</span><span class="ActionScriptBracket/Brace">)</span>;
            
            <span class="ActionScriptReserved">this</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">lookAt</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">target</span><span class="ActionScriptBracket/Brace">)</span>;
        <span class="ActionScriptBracket/Brace">}</span>
        
        <span class="ActionScriptReserved">public</span> <span class="ActionScriptReserved">override</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">projectFaces</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">faces</span>:<span class="ActionScriptDefault_Text">Array</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">object</span>:<span class="ActionScriptDefault_Text">DisplayObject3D</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">renderSessionData</span>:<span class="ActionScriptDefault_Text">RenderSessionData</span><span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptDefault_Text">Number</span><span class="ActionScriptBracket/Brace">{</span>
                
        <span class="ActionScriptComment">/*      
            //alternative way - less code but slower
            
            var vertices:Array = [];
            var uniques:Dictionary = new Dictionary(true);
            
            for each(var f:Triangle3D in faces){
                for each(var v:Vertex3D in f.vertices){
                    if(!uniques[v]){
                        vertices.push(v);
                        uniques[v] = true;
                    }
                } 
                //vertices.push(f.v0, f.v1, f.v2);
            }    
            
            return projectVertices(vertices, object, renderSessionData);  */</span>
            
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">view</span>        :<span class="ActionScriptDefault_Text">Matrix3D</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">object</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">view</span><span class="ActionScriptOperator">,</span>
                <span class="ActionScriptDefault_Text">m11</span>         :<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">view</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">n11</span><span class="ActionScriptOperator">,</span>
                <span class="ActionScriptDefault_Text">m12</span>         :<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">view</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">n12</span><span class="ActionScriptOperator">,</span>
                <span class="ActionScriptDefault_Text">m13</span>         :<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">view</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">n13</span><span class="ActionScriptOperator">,</span>
                <span class="ActionScriptDefault_Text">m21</span>         :<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">view</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">n21</span><span class="ActionScriptOperator">,</span>
                <span class="ActionScriptDefault_Text">m22</span>         :<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">view</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">n22</span><span class="ActionScriptOperator">,</span>
                <span class="ActionScriptDefault_Text">m23</span>         :<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">view</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">n23</span><span class="ActionScriptOperator">,</span>
                <span class="ActionScriptDefault_Text">m31</span>         :<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">view</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">n31</span><span class="ActionScriptOperator">,</span>
                <span class="ActionScriptDefault_Text">m32</span>         :<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">view</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">n32</span><span class="ActionScriptOperator">,</span>
                <span class="ActionScriptDefault_Text">m33</span>         :<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">view</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">n33</span><span class="ActionScriptOperator">,</span>
                <span class="ActionScriptDefault_Text">m41</span>         :<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">view</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">n41</span><span class="ActionScriptOperator">,</span>
                <span class="ActionScriptDefault_Text">m42</span>         :<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">view</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">n42</span><span class="ActionScriptOperator">,</span>
                <span class="ActionScriptDefault_Text">m43</span>         :<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">view</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">n43</span><span class="ActionScriptOperator">,</span>
                <span class="ActionScriptDefault_Text">vx</span>            :<span class="ActionScriptDefault_Text">Number</span><span class="ActionScriptOperator">,</span>
                <span class="ActionScriptDefault_Text">vy</span>            :<span class="ActionScriptDefault_Text">Number</span><span class="ActionScriptOperator">,</span>
                <span class="ActionScriptDefault_Text">vz</span>            :<span class="ActionScriptDefault_Text">Number</span><span class="ActionScriptOperator">,</span>
                <span class="ActionScriptDefault_Text">s_x</span>            :<span class="ActionScriptDefault_Text">Number</span><span class="ActionScriptOperator">,</span>
                <span class="ActionScriptDefault_Text">s_y</span>            :<span class="ActionScriptDefault_Text">Number</span><span class="ActionScriptOperator">,</span>
                <span class="ActionScriptDefault_Text">s_z</span>            :<span class="ActionScriptDefault_Text">Number</span><span class="ActionScriptOperator">,</span>
                <span class="ActionScriptDefault_Text">s_w</span>            :<span class="ActionScriptDefault_Text">Number</span><span class="ActionScriptOperator">,</span>
                <span class="ActionScriptDefault_Text">vertex</span>        :<span class="ActionScriptDefault_Text">Vertex3D</span><span class="ActionScriptOperator">,</span> 
                <span class="ActionScriptDefault_Text">screen</span>        :<span class="ActionScriptDefault_Text">Vertex3DInstance</span><span class="ActionScriptOperator">,</span>
                <span class="ActionScriptDefault_Text">persp</span>         :<span class="ActionScriptDefault_Text">Number</span><span class="ActionScriptOperator">,</span>
                <span class="ActionScriptDefault_Text">i</span>            :<span class="ActionScriptDefault_Text">int</span>    <span class="ActionScriptOperator">=</span> 0<span class="ActionScriptOperator">,</span>
                <span class="ActionScriptDefault_Text">focus</span>        :<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">renderSessionData</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">camera</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">focus</span><span class="ActionScriptOperator">,</span>
                <span class="ActionScriptDefault_Text">fz</span>           :<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">focus</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">renderSessionData</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">camera</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">zoom</span><span class="ActionScriptOperator">,</span>
                <span class="ActionScriptDefault_Text">vpw</span>            :<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">viewport</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">width</span> <span class="ActionScriptOperator">/</span> 2<span class="ActionScriptOperator">,</span>
                <span class="ActionScriptDefault_Text">vph</span>            :<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">viewport</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">height</span> <span class="ActionScriptOperator">/</span> 2<span class="ActionScriptOperator">,</span>
                <span class="ActionScriptDefault_Text">far</span>            :<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">renderSessionData</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">camera</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">far</span><span class="ActionScriptOperator">,</span>
                <span class="ActionScriptDefault_Text">fdist</span>        :<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">far</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">focus</span><span class="ActionScriptOperator">,</span>
                <span class="ActionScriptDefault_Text">vertices</span>    :<span class="ActionScriptDefault_Text">Array</span>;
                
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">time</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">getTimer</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;
            
            <span class="ActionScriptReserved">for each</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">f</span>:<span class="ActionScriptDefault_Text">Triangle3D</span> <span class="ActionScriptReserved">in</span> <span class="ActionScriptDefault_Text">faces</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptBracket/Brace">{</span>
                
                <span class="ActionScriptDefault_Text">vertices</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">f</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">vertices</span>;
                <span class="ActionScriptDefault_Text">i</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">vertices</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">length</span>; 
                
                <span class="ActionScriptReserved">while</span><span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptDefault_Text">vertex</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">vertices</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptOperator">--</span><span class="ActionScriptDefault_Text">i</span><span class="ActionScriptBracket/Brace">]</span> <span class="ActionScriptBracket/Brace">)</span>
                <span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">vertex</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">timestamp</span> <span class="ActionScriptOperator">==</span> <span class="ActionScriptDefault_Text">time</span><span class="ActionScriptBracket/Brace">)</span>
                        <span class="ActionScriptReserved">continue</span>;
                    
                    <span class="ActionScriptDefault_Text">vertex</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">timestamp</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">time</span>;
                    <span class="ActionScriptComment">// Center position
</span>                    <span class="ActionScriptDefault_Text">vx</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">vertex</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span>;
                    <span class="ActionScriptDefault_Text">vy</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">vertex</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span>;
                    <span class="ActionScriptDefault_Text">vz</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">vertex</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">z</span>;
                    
                    <span class="ActionScriptDefault_Text">s_z</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">vx</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">m31</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">vy</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">m32</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">vz</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">m33</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">view</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">n34</span>;
                    
                    <span class="ActionScriptDefault_Text">screen</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">vertex</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">vertex3DInstance</span>;
                    
                    <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_useProjectionMatrix</span><span class="ActionScriptBracket/Brace">)</span>
                    <span class="ActionScriptBracket/Brace">{</span>
                        <span class="ActionScriptDefault_Text">s_w</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">vx</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">m41</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">vy</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">m42</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">vz</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">m43</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">view</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">n44</span>;
                        <span class="ActionScriptComment">// to normalized clip space (0.0 to 1.0)
</span>                        <span class="ActionScriptComment">// NOTE: can skip and simply test (s_z &lt; 0) and save a div
</span>                        <span class="ActionScriptDefault_Text">s_z</span> <span class="ActionScriptOperator">/=</span> <span class="ActionScriptDefault_Text">s_w</span>;
                        
                        <span class="ActionScriptComment">// is point between near- and far-plane?
</span>                        <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptDefault_Text">screen</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">visible</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">s_z</span> <span class="ActionScriptOperator">&gt;</span> 0 <span class="ActionScriptOperator">&amp;&amp;</span> <span class="ActionScriptDefault_Text">s_z</span> <span class="ActionScriptOperator">&lt;</span> 1<span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">)</span>
                        <span class="ActionScriptBracket/Brace">{</span>
                            <span class="ActionScriptComment">// to normalized clip space (-1,-1) to (1, 1)
</span>                            <span class="ActionScriptDefault_Text">s_x</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">vx</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">m11</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">vy</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">m12</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">vz</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">m13</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">view</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">n14</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">/</span> <span class="ActionScriptDefault_Text">s_w</span>;
                            <span class="ActionScriptDefault_Text">s_y</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">vx</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">m21</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">vy</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">m22</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">vz</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">m23</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">view</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">n24</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">/</span> <span class="ActionScriptDefault_Text">s_w</span>;
    
                            <span class="ActionScriptComment">// project to viewport.
</span>                            <span class="ActionScriptDefault_Text">screen</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">s_x</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">vpw</span>;
                            <span class="ActionScriptDefault_Text">screen</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">s_y</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">vph</span>;
                            
                            <span class="ActionScriptComment">// NOTE: z not linear, value increases when nearing far-plane.
</span>                            <span class="ActionScriptDefault_Text">screen</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">z</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">s_z</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">s_w</span>;
                        <span class="ActionScriptBracket/Brace">}</span>
                    <span class="ActionScriptBracket/Brace">}</span>
                    <span class="ActionScriptReserved">else</span>
                    <span class="ActionScriptBracket/Brace">{</span>
                        <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">screen</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">visible</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptDefault_Text">focus</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">s_z</span> <span class="ActionScriptOperator">&gt;</span> 0 <span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptBracket/Brace">)</span>
                        <span class="ActionScriptBracket/Brace">{</span>
                            <span class="ActionScriptDefault_Text">s_x</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">vx</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">m11</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">vy</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">m12</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">vz</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">m13</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">view</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">n14</span>;
                            <span class="ActionScriptDefault_Text">s_y</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">vx</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">m21</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">vy</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">m22</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">vz</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">m23</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">view</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">n24</span>;
                            
                            <span class="ActionScriptDefault_Text">persp</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">fz</span> <span class="ActionScriptOperator">/</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">focus</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">s_z</span><span class="ActionScriptBracket/Brace">)</span>;
                            <span class="ActionScriptDefault_Text">screen</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">s_x</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">persp</span>;
                            <span class="ActionScriptDefault_Text">screen</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">s_y</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">persp</span>;
                            <span class="ActionScriptDefault_Text">screen</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">z</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">s_z</span>;
                        <span class="ActionScriptBracket/Brace">}</span>
                    <span class="ActionScriptBracket/Brace">}</span>
                <span class="ActionScriptBracket/Brace">}</span>

            <span class="ActionScriptBracket/Brace">}</span>
            
            <span class="ActionScriptReserved">return</span> 0;
            
            
        <span class="ActionScriptBracket/Brace">}</span>
        
        
        
        <span class="ActionScriptASDoc">/**
         * Projects vertices.
         * 
         * @param    object                     The &lt;code&gt;DisplayObject3D&lt;/code&gt; to be projected
         * @param    renderSessionData        The &lt;code&gt;RenderSessionData&lt;/code&gt; holding the containing the camera properties
         */</span> 
        <span class="ActionScriptReserved">public</span> <span class="ActionScriptReserved">override</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">projectVertices</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">vertices</span>:<span class="ActionScriptDefault_Text">Array</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">object</span>:<span class="ActionScriptDefault_Text">DisplayObject3D</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">renderSessionData</span>:<span class="ActionScriptDefault_Text">RenderSessionData</span><span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptDefault_Text">Number</span>
        <span class="ActionScriptBracket/Brace">{</span>
                
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">view</span>        :<span class="ActionScriptDefault_Text">Matrix3D</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">object</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">view</span><span class="ActionScriptOperator">,</span>
                <span class="ActionScriptDefault_Text">m11</span>         :<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">view</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">n11</span><span class="ActionScriptOperator">,</span>
                <span class="ActionScriptDefault_Text">m12</span>         :<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">view</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">n12</span><span class="ActionScriptOperator">,</span>
                <span class="ActionScriptDefault_Text">m13</span>         :<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">view</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">n13</span><span class="ActionScriptOperator">,</span>
                <span class="ActionScriptDefault_Text">m21</span>         :<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">view</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">n21</span><span class="ActionScriptOperator">,</span>
                <span class="ActionScriptDefault_Text">m22</span>         :<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">view</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">n22</span><span class="ActionScriptOperator">,</span>
                <span class="ActionScriptDefault_Text">m23</span>         :<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">view</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">n23</span><span class="ActionScriptOperator">,</span>
                <span class="ActionScriptDefault_Text">m31</span>         :<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">view</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">n31</span><span class="ActionScriptOperator">,</span>
                <span class="ActionScriptDefault_Text">m32</span>         :<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">view</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">n32</span><span class="ActionScriptOperator">,</span>
                <span class="ActionScriptDefault_Text">m33</span>         :<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">view</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">n33</span><span class="ActionScriptOperator">,</span>
                <span class="ActionScriptDefault_Text">m41</span>         :<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">view</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">n41</span><span class="ActionScriptOperator">,</span>
                <span class="ActionScriptDefault_Text">m42</span>         :<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">view</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">n42</span><span class="ActionScriptOperator">,</span>
                <span class="ActionScriptDefault_Text">m43</span>         :<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">view</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">n43</span><span class="ActionScriptOperator">,</span>
                <span class="ActionScriptDefault_Text">vx</span>            :<span class="ActionScriptDefault_Text">Number</span><span class="ActionScriptOperator">,</span>
                <span class="ActionScriptDefault_Text">vy</span>            :<span class="ActionScriptDefault_Text">Number</span><span class="ActionScriptOperator">,</span>
                <span class="ActionScriptDefault_Text">vz</span>            :<span class="ActionScriptDefault_Text">Number</span><span class="ActionScriptOperator">,</span>
                <span class="ActionScriptDefault_Text">s_x</span>            :<span class="ActionScriptDefault_Text">Number</span><span class="ActionScriptOperator">,</span>
                <span class="ActionScriptDefault_Text">s_y</span>            :<span class="ActionScriptDefault_Text">Number</span><span class="ActionScriptOperator">,</span>
                <span class="ActionScriptDefault_Text">s_z</span>            :<span class="ActionScriptDefault_Text">Number</span><span class="ActionScriptOperator">,</span>
                <span class="ActionScriptDefault_Text">s_w</span>            :<span class="ActionScriptDefault_Text">Number</span><span class="ActionScriptOperator">,</span>
                <span class="ActionScriptDefault_Text">vertex</span>        :<span class="ActionScriptDefault_Text">Vertex3D</span><span class="ActionScriptOperator">,</span> 
                <span class="ActionScriptDefault_Text">screen</span>        :<span class="ActionScriptDefault_Text">Vertex3DInstance</span><span class="ActionScriptOperator">,</span>
                <span class="ActionScriptDefault_Text">persp</span>         :<span class="ActionScriptDefault_Text">Number</span><span class="ActionScriptOperator">,</span>
                <span class="ActionScriptDefault_Text">i</span>            :<span class="ActionScriptDefault_Text">int</span>    <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">vertices</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">length</span><span class="ActionScriptOperator">,</span>
                <span class="ActionScriptDefault_Text">focus</span>        :<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">renderSessionData</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">camera</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">focus</span><span class="ActionScriptOperator">,</span>
                <span class="ActionScriptDefault_Text">fz</span>           :<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">focus</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">renderSessionData</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">camera</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">zoom</span><span class="ActionScriptOperator">,</span>
                <span class="ActionScriptDefault_Text">vpw</span>            :<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">viewport</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">width</span> <span class="ActionScriptOperator">/</span> 2<span class="ActionScriptOperator">,</span>
                <span class="ActionScriptDefault_Text">vph</span>            :<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">viewport</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">height</span> <span class="ActionScriptOperator">/</span> 2<span class="ActionScriptOperator">,</span>
                <span class="ActionScriptDefault_Text">far</span>            :<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">renderSessionData</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">camera</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">far</span><span class="ActionScriptOperator">,</span>
                <span class="ActionScriptDefault_Text">fdist</span>        :<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">far</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">focus</span>;
            
            <span class="ActionScriptReserved">while</span><span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptDefault_Text">vertex</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">vertices</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptOperator">--</span><span class="ActionScriptDefault_Text">i</span><span class="ActionScriptBracket/Brace">]</span> <span class="ActionScriptBracket/Brace">)</span>
            <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptComment">// Center position
</span>                <span class="ActionScriptDefault_Text">vx</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">vertex</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span>;
                <span class="ActionScriptDefault_Text">vy</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">vertex</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span>;
                <span class="ActionScriptDefault_Text">vz</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">vertex</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">z</span>;
                
                <span class="ActionScriptDefault_Text">s_z</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">vx</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">m31</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">vy</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">m32</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">vz</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">m33</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">view</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">n34</span>;
                
                <span class="ActionScriptDefault_Text">screen</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">vertex</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">vertex3DInstance</span>;
                
                
                <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_useProjectionMatrix</span><span class="ActionScriptBracket/Brace">)</span>
                <span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScriptDefault_Text">s_w</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">vx</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">m41</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">vy</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">m42</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">vz</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">m43</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">view</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">n44</span>;
                    <span class="ActionScriptComment">// to normalized clip space (0.0 to 1.0)
</span>                    <span class="ActionScriptComment">// NOTE: can skip and simply test (s_z &lt; 0) and save a div
</span>                    <span class="ActionScriptDefault_Text">s_z</span> <span class="ActionScriptOperator">/=</span> <span class="ActionScriptDefault_Text">s_w</span>;

                    <span class="ActionScriptComment">// is point between near- and far-plane?
</span>                    <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptDefault_Text">screen</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">visible</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">s_z</span> <span class="ActionScriptOperator">&gt;</span> 0 <span class="ActionScriptOperator">&amp;&amp;</span> <span class="ActionScriptDefault_Text">s_z</span> <span class="ActionScriptOperator">&lt;</span> 1<span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">)</span>
                    <span class="ActionScriptBracket/Brace">{</span>
                        <span class="ActionScriptComment">// to normalized clip space (-1,-1) to (1, 1)
</span>                        <span class="ActionScriptDefault_Text">s_x</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">vx</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">m11</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">vy</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">m12</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">vz</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">m13</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">view</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">n14</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">/</span> <span class="ActionScriptDefault_Text">s_w</span>;
                        <span class="ActionScriptDefault_Text">s_y</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">vx</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">m21</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">vy</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">m22</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">vz</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">m23</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">view</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">n24</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">/</span> <span class="ActionScriptDefault_Text">s_w</span>;

                        <span class="ActionScriptComment">// project to viewport.
</span>                        <span class="ActionScriptDefault_Text">screen</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">s_x</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">vpw</span>;
                        <span class="ActionScriptDefault_Text">screen</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">s_y</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">vph</span>;

                        <span class="ActionScriptComment">// NOTE: z not linear, value increases when nearing far-plane.
</span>                        <span class="ActionScriptDefault_Text">screen</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">z</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">s_z</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">s_w</span>;
                    <span class="ActionScriptBracket/Brace">}</span>
                <span class="ActionScriptBracket/Brace">}</span>
                <span class="ActionScriptReserved">else</span>
                <span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">screen</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">visible</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptDefault_Text">focus</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">s_z</span> <span class="ActionScriptOperator">&gt;</span> 0 <span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptBracket/Brace">)</span>
                    <span class="ActionScriptBracket/Brace">{</span>
                        <span class="ActionScriptDefault_Text">s_x</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">vx</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">m11</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">vy</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">m12</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">vz</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">m13</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">view</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">n14</span>;
                        <span class="ActionScriptDefault_Text">s_y</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">vx</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">m21</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">vy</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">m22</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">vz</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">m23</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">view</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">n24</span>;
                        
                        <span class="ActionScriptDefault_Text">persp</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">fz</span> <span class="ActionScriptOperator">/</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">focus</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">s_z</span><span class="ActionScriptBracket/Brace">)</span>;
                        <span class="ActionScriptDefault_Text">screen</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">s_x</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">persp</span>;
                        <span class="ActionScriptDefault_Text">screen</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">s_y</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">persp</span>;
                        <span class="ActionScriptDefault_Text">screen</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">z</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">s_z</span>;
                    <span class="ActionScriptBracket/Brace">}</span>
                <span class="ActionScriptBracket/Brace">}</span>
            <span class="ActionScriptBracket/Brace">}</span>

            <span class="ActionScriptReserved">return</span> 0;
        <span class="ActionScriptBracket/Brace">}</span>
        
        <span class="ActionScriptASDoc">/**
         * Updates the internal camera settings.
         * 
         * @param    viewport
         */</span> 
        <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">update</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">viewport</span>:<span class="ActionScriptDefault_Text">Rectangle</span><span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptReserved">void</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptOperator">!</span><span class="ActionScriptDefault_Text">viewport</span><span class="ActionScriptBracket/Brace">)</span>
                <span class="ActionScriptReserved">throw</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">Error</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">"Camera3D#update: Invalid viewport rectangle! "</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">viewport</span><span class="ActionScriptBracket/Brace">)</span>;
    
            <span class="ActionScriptReserved">this</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">viewport</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">viewport</span>;

            <span class="ActionScriptComment">// used to detect value changes
</span>            <span class="ActionScriptDefault_Text">_prevFocus</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">this</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">focus</span>;
            <span class="ActionScriptDefault_Text">_prevZoom</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">this</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">zoom</span>;
            <span class="ActionScriptDefault_Text">_prevWidth</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">this</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">viewport</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">width</span>;
            <span class="ActionScriptDefault_Text">_prevHeight</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">this</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">viewport</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">height</span>;

            <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_prevOrtho</span> <span class="ActionScriptOperator">!=</span> <span class="ActionScriptReserved">this</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">ortho</span><span class="ActionScriptBracket/Brace">)</span>
            <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptReserved">this</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">ortho</span><span class="ActionScriptBracket/Brace">)</span>
                <span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScriptDefault_Text">_prevOrthoProjection</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">this</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">useProjectionMatrix</span>;
                    <span class="ActionScriptReserved">this</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">useProjectionMatrix</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">true</span>;    
                <span class="ActionScriptBracket/Brace">}</span>
                <span class="ActionScriptReserved">else</span>
                    <span class="ActionScriptReserved">this</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">useProjectionMatrix</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">_prevOrthoProjection</span>;
            <span class="ActionScriptBracket/Brace">}</span>
            
            <span class="ActionScriptReserved">this</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">useProjectionMatrix</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">this</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">_useProjectionMatrix</span>;    
            
            <span class="ActionScriptDefault_Text">_prevOrtho</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">this</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">ortho</span>;
            <span class="ActionScriptDefault_Text">_prevUseProjection</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">_useProjectionMatrix</span>;
            
            <span class="ActionScriptReserved">this</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">useCulling</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">_useCulling</span>;
        <span class="ActionScriptBracket/Brace">}</span>
        
        <span class="ActionScriptASDoc">/**
         * [INTERNAL-USE] Transforms world coordinates into camera space.
         * 
         * @param    transform    An optional transform.
         */</span> 
        <span class="ActionScriptReserved">public</span> <span class="ActionScriptReserved">override</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">transformView</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">transform</span>:<span class="ActionScriptDefault_Text">Matrix3D</span><span class="ActionScriptOperator">=</span><span class="ActionScriptReserved">null</span><span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptReserved">void</span>
        <span class="ActionScriptBracket/Brace">{</span>    
            <span class="ActionScriptComment">// check whether camera internals need updating
</span>            <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span>    <span class="ActionScriptDefault_Text">ortho</span> <span class="ActionScriptOperator">!=</span> <span class="ActionScriptDefault_Text">_prevOrtho</span> <span class="ActionScriptOperator">||</span> <span class="ActionScriptDefault_Text">_prevUseProjection</span> <span class="ActionScriptOperator">!=</span> <span class="ActionScriptDefault_Text">_useProjectionMatrix</span> <span class="ActionScriptOperator">||</span> 
                <span class="ActionScriptDefault_Text">focus</span> <span class="ActionScriptOperator">!=</span> <span class="ActionScriptDefault_Text">_prevFocus</span> <span class="ActionScriptOperator">||</span> <span class="ActionScriptDefault_Text">zoom</span> <span class="ActionScriptOperator">!=</span> <span class="ActionScriptDefault_Text">_prevZoom</span> <span class="ActionScriptOperator">||</span> <span class="ActionScriptDefault_Text">viewport</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">width</span> <span class="ActionScriptOperator">!=</span> <span class="ActionScriptDefault_Text">_prevWidth</span> <span class="ActionScriptOperator">||</span> <span class="ActionScriptDefault_Text">viewport</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">height</span> <span class="ActionScriptOperator">!=</span> <span class="ActionScriptDefault_Text">_prevHeight</span><span class="ActionScriptBracket/Brace">)</span>
            <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptDefault_Text">update</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">viewport</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptBracket/Brace">}</span>
            
            <span class="ActionScriptComment">// handle camera 'types'
</span>            <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_target</span><span class="ActionScriptBracket/Brace">)</span>
            <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptComment">// Target camera...
</span>                <span class="ActionScriptDefault_Text">lookAt</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_target</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptBracket/Brace">}</span>
            <span class="ActionScriptReserved">else</span> <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_transformDirty</span><span class="ActionScriptBracket/Brace">)</span>
            <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptComment">// Free camera...
</span>                <span class="ActionScriptDefault_Text">updateTransform</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptBracket/Brace">}</span>
            
            <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_useProjectionMatrix</span><span class="ActionScriptBracket/Brace">)</span>
            <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptReserved">super</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">transformView</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptReserved">this</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">eye</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">calculateMultiply4x4</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_projection</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptReserved">this</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">eye</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptBracket/Brace">}</span>
            <span class="ActionScriptReserved">else</span>
            <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptDefault_Text">_focusFix</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">copy</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptReserved">this</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">transform</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptDefault_Text">_focusFix</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">n14</span> <span class="ActionScriptOperator">+=</span> <span class="ActionScriptDefault_Text">focus</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptReserved">this</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">transform</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">n13</span>;
                <span class="ActionScriptDefault_Text">_focusFix</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">n24</span> <span class="ActionScriptOperator">+=</span> <span class="ActionScriptDefault_Text">focus</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptReserved">this</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">transform</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">n23</span>;
                <span class="ActionScriptDefault_Text">_focusFix</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">n34</span> <span class="ActionScriptOperator">+=</span> <span class="ActionScriptDefault_Text">focus</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptReserved">this</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">transform</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">n33</span>;
                <span class="ActionScriptReserved">super</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">transformView</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_focusFix</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptBracket/Brace">}</span>
            
            <span class="ActionScriptComment">// handle frustum if available
</span>            <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">culler</span> <span class="ActionScriptReserved">is</span> <span class="ActionScriptDefault_Text">FrustumCuller</span><span class="ActionScriptBracket/Brace">)</span>
            <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptComment">// The frustum culler simply uses the camera transform
</span>                <span class="ActionScriptDefault_Text">FrustumCuller</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">culler</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">transform</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">copy</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptReserved">this</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">transform</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptBracket/Brace">}</span>
        <span class="ActionScriptBracket/Brace">}</span>
        
        <span class="ActionScriptASDoc">/**
         * Whether this camera uses frustum culling.
         * 
         * @return Boolean
         */</span> 
        <span class="ActionScriptReserved">public</span> <span class="ActionScriptReserved">override</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptReserved">set</span> <span class="ActionScriptDefault_Text">useCulling</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">value</span>:<span class="ActionScriptDefault_Text">Boolean</span><span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptReserved">void</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptReserved">super</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">useCulling</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">value</span>;
            
            <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_useCulling</span><span class="ActionScriptBracket/Brace">)</span>
            <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptOperator">!</span><span class="ActionScriptReserved">this</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">culler</span><span class="ActionScriptBracket/Brace">)</span>
                    <span class="ActionScriptReserved">this</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">culler</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">FrustumCuller</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;
                    
                <span class="ActionScriptDefault_Text">FrustumCuller</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptReserved">this</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">culler</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">initialize</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptReserved">this</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">fov</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptReserved">this</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">viewport</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">width</span><span class="ActionScriptOperator">/</span><span class="ActionScriptReserved">this</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">viewport</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">height</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptReserved">this</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">focus</span><span class="ActionScriptOperator">/</span><span class="ActionScriptReserved">this</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">zoom</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">_far</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptBracket/Brace">}</span>
            <span class="ActionScriptReserved">else</span>
                <span class="ActionScriptReserved">this</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">culler</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">null</span>;    
        <span class="ActionScriptBracket/Brace">}</span>
        
        <span class="ActionScriptASDoc">/**
         * Whether this camera uses a projection matrix.
         */</span>
        <span class="ActionScriptReserved">public</span> <span class="ActionScriptReserved">override</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptReserved">set</span> <span class="ActionScriptDefault_Text">useProjectionMatrix</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">value</span>:<span class="ActionScriptDefault_Text">Boolean</span><span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptReserved">void</span>
        <span class="ActionScriptBracket/Brace">{</span>    
            <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">value</span><span class="ActionScriptBracket/Brace">)</span>
            <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptReserved">this</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">ortho</span><span class="ActionScriptBracket/Brace">)</span>
                <span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">w</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">viewport</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">width</span> <span class="ActionScriptOperator">/</span> 2;
                    <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">h</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">viewport</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">height</span> <span class="ActionScriptOperator">/</span> 2;    
                    <span class="ActionScriptDefault_Text">_projection</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">createOrthoMatrix</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptOperator">-</span><span class="ActionScriptDefault_Text">w</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">w</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptOperator">-</span><span class="ActionScriptDefault_Text">h</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">h</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptOperator">-</span><span class="ActionScriptDefault_Text">_far</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">_far</span><span class="ActionScriptBracket/Brace">)</span>;    
                    <span class="ActionScriptDefault_Text">_projection</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">Matrix3D</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">multiply</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_orthoScaleMatrix</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">_projection</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptBracket/Brace">}</span>
                <span class="ActionScriptReserved">else</span>
                    <span class="ActionScriptDefault_Text">_projection</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">createPerspectiveMatrix</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">fov</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">viewport</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">width</span><span class="ActionScriptOperator">/</span><span class="ActionScriptDefault_Text">viewport</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">height</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptReserved">this</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">focus</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptReserved">this</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">far</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptBracket/Brace">}</span>
            <span class="ActionScriptReserved">else</span>
            <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptReserved">this</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">ortho</span><span class="ActionScriptBracket/Brace">)</span>
                    <span class="ActionScriptDefault_Text">value</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">true</span>;
            <span class="ActionScriptBracket/Brace">}</span>
            <span class="ActionScriptReserved">super</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">useProjectionMatrix</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">value</span>;
        <span class="ActionScriptBracket/Brace">}</span>
        
        <span class="ActionScriptASDoc">/**
         * Sets the distance to the far plane.
         * 
         * @param    value    The distance to the far plane
         */</span> 
        <span class="ActionScriptReserved">public</span> <span class="ActionScriptReserved">override</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptReserved">set</span> <span class="ActionScriptDefault_Text">far</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">value</span>:<span class="ActionScriptDefault_Text">Number</span><span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptReserved">void</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">value</span> <span class="ActionScriptOperator">&gt;</span> <span class="ActionScriptReserved">this</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">focus</span><span class="ActionScriptBracket/Brace">)</span>
            <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptDefault_Text">_far</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">value</span>;
                <span class="ActionScriptReserved">this</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">update</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptReserved">this</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">viewport</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptBracket/Brace">}</span>
        <span class="ActionScriptBracket/Brace">}</span>
        
        <span class="ActionScriptASDoc">/**
         * Sets the distance to the near plane (note that this is simply an alias for #focus).
         * 
         * @param    value    The distance to the near plane
         */</span>  
        <span class="ActionScriptReserved">public</span> <span class="ActionScriptReserved">override</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptReserved">set</span> <span class="ActionScriptDefault_Text">near</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">value</span>:<span class="ActionScriptDefault_Text">Number</span><span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptReserved">void</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">value</span> <span class="ActionScriptOperator">&gt;</span> 0<span class="ActionScriptBracket/Brace">)</span>
            <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptReserved">this</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">focus</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">value</span>;
                <span class="ActionScriptReserved">this</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">update</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptReserved">this</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">viewport</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptBracket/Brace">}</span>
        <span class="ActionScriptBracket/Brace">}</span>
        
        <span class="ActionScriptASDoc">/**
         * Sets the orthographic scale of the camera
         * 
         * @param value        The value of the orthographic scale
         */</span>

        <span class="ActionScriptReserved">public</span> <span class="ActionScriptReserved">override</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptReserved">set</span> <span class="ActionScriptDefault_Text">orthoScale</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">value</span>:<span class="ActionScriptDefault_Text">Number</span><span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptReserved">void</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptReserved">super</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">orthoScale</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">value</span>;
            <span class="ActionScriptReserved">this</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">useProjectionMatrix</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">this</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">useProjectionMatrix</span>;
            <span class="ActionScriptDefault_Text">_prevOrtho</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptOperator">!</span><span class="ActionScriptReserved">this</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">ortho</span>;
            <span class="ActionScriptReserved">this</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">update</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptReserved">this</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">viewport</span><span class="ActionScriptBracket/Brace">)</span>;    
        <span class="ActionScriptBracket/Brace">}</span>
        
        <span class="ActionScriptASDoc">/**
         * Creates a transformation that produces a parallel projection.
         * 
         * @param    left
         * @param    right
         * @param    bottom
         * @param    top
         * @param    near
         * @param    far
         * @return    Matrix3D
         */</span>
        <span class="ActionScriptReserved">public</span> <span class="ActionScriptReserved">static</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">createOrthoMatrix</span><span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptDefault_Text">left</span>:<span class="ActionScriptDefault_Text">Number</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">right</span>:<span class="ActionScriptDefault_Text">Number</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">bottom</span>:<span class="ActionScriptDefault_Text">Number</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">top</span>:<span class="ActionScriptDefault_Text">Number</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">near</span>:<span class="ActionScriptDefault_Text">Number</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">far</span>:<span class="ActionScriptDefault_Text">Number</span><span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptDefault_Text">Matrix3D</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">tx</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">right</span><span class="ActionScriptOperator">+</span><span class="ActionScriptDefault_Text">left</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">/</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">right</span><span class="ActionScriptOperator">-</span><span class="ActionScriptDefault_Text">left</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">ty</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">top</span><span class="ActionScriptOperator">+</span><span class="ActionScriptDefault_Text">bottom</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">/</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">top</span><span class="ActionScriptOperator">-</span><span class="ActionScriptDefault_Text">bottom</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">tz</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">far</span><span class="ActionScriptOperator">+</span><span class="ActionScriptDefault_Text">near</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">/</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">far</span><span class="ActionScriptOperator">-</span><span class="ActionScriptDefault_Text">near</span><span class="ActionScriptBracket/Brace">)</span>;
                
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">matrix</span>:<span class="ActionScriptDefault_Text">Matrix3D</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">Matrix3D</span><span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptBracket/Brace">[</span>
                2<span class="ActionScriptOperator">/</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">right</span><span class="ActionScriptOperator">-</span><span class="ActionScriptDefault_Text">left</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">,</span> 0<span class="ActionScriptOperator">,</span> 0<span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">tx</span><span class="ActionScriptOperator">,</span>
                0<span class="ActionScriptOperator">,</span> 2<span class="ActionScriptOperator">/</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">top</span><span class="ActionScriptOperator">-</span><span class="ActionScriptDefault_Text">bottom</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">,</span> 0<span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">ty</span><span class="ActionScriptOperator">,</span>
                0<span class="ActionScriptOperator">,</span> 0<span class="ActionScriptOperator">,</span> <span class="ActionScriptOperator">-</span>2<span class="ActionScriptOperator">/</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">far</span><span class="ActionScriptOperator">-</span><span class="ActionScriptDefault_Text">near</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">tz</span><span class="ActionScriptOperator">,</span>
                0<span class="ActionScriptOperator">,</span> 0<span class="ActionScriptOperator">,</span> 0<span class="ActionScriptOperator">,</span> 1 
            <span class="ActionScriptBracket/Brace">]</span> <span class="ActionScriptBracket/Brace">)</span>;
            
            <span class="ActionScriptDefault_Text">matrix</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">calculateMultiply</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">Matrix3D</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">scaleMatrix</span><span class="ActionScriptBracket/Brace">(</span>1<span class="ActionScriptOperator">,</span>1<span class="ActionScriptOperator">,</span><span class="ActionScriptOperator">-</span>1<span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">matrix</span><span class="ActionScriptBracket/Brace">)</span>;
            
            <span class="ActionScriptReserved">return</span> <span class="ActionScriptDefault_Text">matrix</span>;
        <span class="ActionScriptBracket/Brace">}</span>
            
        <span class="ActionScriptASDoc">/**
         * Creates a transformation that produces a perspective projection.
         * 
         * @param    fov
         * @param    aspect
         * @param    near
         * @param    far
         * @return    Matrix3D
         */</span>
        <span class="ActionScriptReserved">public</span> <span class="ActionScriptReserved">static</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">createPerspectiveMatrix</span><span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptDefault_Text">fov</span>:<span class="ActionScriptDefault_Text">Number</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">aspect</span>:<span class="ActionScriptDefault_Text">Number</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">near</span>:<span class="ActionScriptDefault_Text">Number</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">far</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptDefault_Text">Matrix3D</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">fov2</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">fov</span><span class="ActionScriptOperator">/</span>2<span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">Math</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">PI</span><span class="ActionScriptOperator">/</span>180<span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">tan</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">Math</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">tan</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">fov2</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">f</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> 1 <span class="ActionScriptOperator">/</span> <span class="ActionScriptDefault_Text">tan</span>;
            
            <span class="ActionScriptReserved">return</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">Matrix3D</span><span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptBracket/Brace">[</span>
                <span class="ActionScriptDefault_Text">f</span><span class="ActionScriptOperator">/</span><span class="ActionScriptDefault_Text">aspect</span><span class="ActionScriptOperator">,</span> 0<span class="ActionScriptOperator">,</span> 0<span class="ActionScriptOperator">,</span> 0<span class="ActionScriptOperator">,</span>
                0<span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">f</span><span class="ActionScriptOperator">,</span> 0<span class="ActionScriptOperator">,</span> 0<span class="ActionScriptOperator">,</span>
                0<span class="ActionScriptOperator">,</span> 0<span class="ActionScriptOperator">,</span> <span class="ActionScriptOperator">-</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">near</span><span class="ActionScriptOperator">+</span><span class="ActionScriptDefault_Text">far</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">/</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">near</span><span class="ActionScriptOperator">-</span><span class="ActionScriptDefault_Text">far</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptBracket/Brace">(</span>2<span class="ActionScriptOperator">*</span><span class="ActionScriptDefault_Text">far</span><span class="ActionScriptOperator">*</span><span class="ActionScriptDefault_Text">near</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">/</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">near</span><span class="ActionScriptOperator">-</span><span class="ActionScriptDefault_Text">far</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">,</span>
                0<span class="ActionScriptOperator">,</span> 0<span class="ActionScriptOperator">,</span> 1<span class="ActionScriptOperator">,</span> 0 
            <span class="ActionScriptBracket/Brace">]</span> <span class="ActionScriptBracket/Brace">)</span>;
        <span class="ActionScriptBracket/Brace">}</span>
        
        <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptReserved">get</span> <span class="ActionScriptDefault_Text">projection</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptDefault_Text">Matrix3D</span> <span class="ActionScriptBracket/Brace">{</span> <span class="ActionScriptReserved">return</span> <span class="ActionScriptDefault_Text">_projection</span>; <span class="ActionScriptBracket/Brace">}</span>
        
        <span class="ActionScriptReserved">protected</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">_projection</span>                : <span class="ActionScriptDefault_Text">Matrix3D</span>;
        <span class="ActionScriptReserved">protected</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">_prevFocus</span>                : <span class="ActionScriptDefault_Text">Number</span>;
        <span class="ActionScriptReserved">protected</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">_prevZoom</span>                : <span class="ActionScriptDefault_Text">Number</span>;
        <span class="ActionScriptReserved">protected</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">_prevWidth</span>                : <span class="ActionScriptDefault_Text">Number</span>;
        <span class="ActionScriptReserved">protected</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">_prevHeight</span>                : <span class="ActionScriptDefault_Text">Number</span>;
        <span class="ActionScriptReserved">protected</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">_prevOrtho</span>                : <span class="ActionScriptDefault_Text">Boolean</span>;
        <span class="ActionScriptReserved">protected</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">_prevOrthoProjection</span>    : <span class="ActionScriptDefault_Text">Boolean</span>;
        <span class="ActionScriptReserved">protected</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">_prevUseProjection</span>        : <span class="ActionScriptDefault_Text">Boolean</span>;
        <span class="ActionScriptReserved">protected</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">_focusFix</span>                : <span class="ActionScriptDefault_Text">Matrix3D</span>;
    <span class="ActionScriptBracket/Brace">}</span>
<span class="ActionScriptBracket/Brace">}</span>
</pre></body>
</html>
